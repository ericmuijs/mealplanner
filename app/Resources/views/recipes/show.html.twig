<div class="modal-header">
	<button type="button" class="close" data-dismiss="modal">&times;</button>
	<h2 class="modal-title">{{ recept.titel }}</h2>
	{{ recept.rating|rating }}
	<a type="button" class="btn btn-default pull-right" href="{{ path('editform', {'id':recept.id}) }}" id="editrecipe_modal"><span class="glyphicon glyphicon-pencil"></span> Wijzig</a>
	<a type="button" class="btn btn-default pull-right" href="{{ path('deleterecept', {'id':recept.id}) }}" id="deleterecipe_modal"><span class="glyphicon glyphicon-trash"></span> Wis</a>
</div>

<div class="modal-body">
		<div class="row">

			<div class="col-sm-8 showrecipe-image">
				<div class="row">
					<div class="col-sm-12">
						{% if recept.fotonaam %}
							{% if recept.fotonaam matches '/^(https|http):\\/\\//' %}
								<img src="{{ recept.fotonaam }}" alt="{{ recept.titel }}" class="img-responsive">
							{% else %}
								<img src="{{ vich_uploader_asset(recept, 'fotoBestand') | imagine_filter('thumb_lg') }}" alt="{{ recept.titel }}" class="img-responsive">
							{% endif %}
						{% else %}
							<img src="{{ asset('images/recepten/default-recipe-big.png') }}" alt="default image" style="max-height: 250px;">
						{% endif %}
					</div>
				</div>

				<div class="row text-center" style="margin-top:10px;">
					{% if recept.gerecht %}
					<div class="col-xs-2">
							<i class="fa fa-cutlery" aria-hidden="true"></i>
							<p class="small">{{ recept.gerecht.name }}</p>
					</div>
					{% endif %}
					{% if recept.keuken %}
					<div class="col-xs-2">
							<i class="fa fa-globe" aria-hidden="true"></i>
							<p class="small">{{ recept.keuken.name }}</p>
					</div>
					{% endif %}
					{% if recept.hoofdingredient %}
					<div class="col-xs-2">
							<i class="fa fa-spoon" aria-hidden="true"></i>
							<p class="small">{{ recept.hoofdingredient.name }}</p>				
					</div>
					{% endif %}	
					{% if (recept.bereidingstijd is not empty) and (recept.bereidingstijd != '00:00:00') %}
					<div class="col-xs-2">
						<i class="fa fa-clock-o" aria-hidden="true"></i>
						<p class="small">{{ recept.bereidingstijd|date("G \\u i \\m\\i\\n") }}</p>					
					</div>
					{% endif %}	
					{% if recept.kostprijs %}
					<div class="col-xs-2">
						<i class="fa fa-money" aria-hidden="true"></i>
						<p class="small">{{ recept.kostprijs }} p.p.</p>				
					</div>
					{% endif %}
					{% if recept.personen %}
					<div class="col-xs-2">
						<i class="fa fa-user-o" aria-hidden="true"></i>
						<p class="small">{{ recept.personen }}</p>
					</div>
					{% endif %}
					<div class="clearfix visible-xs"></div>
					{% if recept.tags|length > 0 %}
					<div class="col-sm-12 text-left">
							<i class="fa fa-tags" aria-hidden="true"></i>
							{% for tag in recept.tags %}
						<span class="label label-default">{{ tag.name }}</span>
							{% endfor %}
					</div>
					{% endif %}
					{% if recept.bron %}
					<div class="col-sm-12 text-left">
					<p class="small" style="margin:10px 0 0;">Bron:
						{% if recept.bron matches '/^http[s]?/' %}
							{% set host = recept.bron|split('/')[2]|trim('www.','left') %}
							<a href="{{ recept.bron }}" target="_blank"><span class="label label-warning">{{ host }}</span></a>
						{% elseif recept.bron matches '/^www/' or recept.bron matches '/^\\w+\\.\\w{2,3}\\/{1}\\w+/' %}
							{% set host = recept.bron|split('/')[0]|trim('www.','left') %}
							<a href="http://{{ recept.bron }}" target="_blank"><span class="label label-warning">{{ host }}</span></a>
						{# Note: Twig auto-escapes the \ character so you have to double escape it! #}s				
						{% else %}
							<span>{{ recept.bron }}</span>
						{% endif %}
					</p>
					</div>
					{% endif %}																		
				</div>

				<div class="row" style="margin-top:20px;">
					<div class="col-sm-12">
						<h3>Bereiding</h3>
						<p>{{ recept.bereidingswijze|raw }}</p>
					</div>
				</div>
			</div>

			<div class="col-sm-4">
				<h3 style="margin-top:0;">IngrediÃ«nten</h3>
				<p class="small">Aantal personen: <input type="number" value="4" min="1" max="20" id="personen" data-url="{{ path('showrecept', {'id':recept.id}) }}"></p>
				<table id="ingredientlist" style="font-size:12px;">
					<thead>
						<tr>
							<td></td>
							<td></td>
						</tr>
					</thead>
					<tbody>
						{% for ingredient in recept.ingredienten %}
						<tr>
							<td class="list-unit">
								<span class="hoeveelheid" data-quantity="{{ (ingredient.hoeveelheid / recept.personen) }}">{% if ingredient.hoeveelheid %}
								{{ (ingredient.hoeveelheid / recept.personen * servings)|number_format(1,',','.')|trim('0','right')|trim(',','right') }}
								{% endif %}</span>
								<span class="eenheid">{{ ingredient.eenheid }}</span>
							</td>
							<td class="list-ingredient {% if ingredient.isSection %}section{% endif %}">
								<span class="ingredient">{{ ingredient.ingredient }}</span>
							</td>
						</tr>
				{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
</div>

<!-- <div class="modal-footer">
	<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
</div> -->

<script>
$(document).ready(function(){
	
	// Modify number of servings via JS
	// Note: does not render well in browsers that do not support toLocaleString (e.g. Safari)
	// $('#personen').on('change',function(){
	// 	var q = $(this).val();
	// 	$('.modal-body span.hoeveelheid').each(function(){
	// 		if ($(this).text() !== ''){
	// 			singleVal = $(this).data("quantity");
	// 			newVal = singleVal * q;
	// 			newVal = newVal.toLocaleString('nl-BE', {maximumFractionDigits:1});
	// 			$(this).html(newVal);
	// 		}
	// 	}); 
	// });

	$('#personen').on('change', function(){
		var url = $(this).data('url');
		var table = $('table#ingredientlist');
		$.ajax({
			type: 'GET',
			url: url,
			data: 'p=' + $('input#personen').val(),
			success: function(html){
				table.replaceWith(
					$(html).find('table#ingredientlist')
				);
			}
		});
	});		

	// Hide modal and open another one
	$('#editrecipe_modal, #deleterecipe_modal').on('click', function(e){
		e.preventDefault();
		var link = $(this).attr('href');
		var myOtherModal = $(this).parents('div#myOtherModal');
		myOtherModal.modal('hide');
		myOtherModal.one('hidden.bs.modal', function(e){
			$('#myModal').modal('show');
			$('#myModal').one('shown.bs.modal', function(e){
				$('#myModalContent').load(link);
			});
		});
	});

});
</script>